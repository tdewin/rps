<html>
<head>
<title>Restore Point Simulator</title>
<link rel="stylesheet" type="text/css" href="pureengine.css">
<link href="jquery-ui.css" rel="stylesheet">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58327247-1', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body class="mainfont">

<script src="jquery-2.0.1.min.js"></script>
<script src="jquery-ui.min.js"></script>
<script src="URI.js"></script>
<script src="moment.min.js"></script>
<script src="filesize-mod.js"></script>
<script src="pureengine.js"></script>

<script>
function showInputs(style)
{
	showInputsWithDefaults(style,true)
}
function showInputsWithDefaults(style,forceDefaults)
{
	
	$( ".inputSpecific" ).hide()
	//allows the scenario function to override everything, even on style
	
	
	if(forceDefaults)
	{
		var gsv = GUIStateVariables()
		$.each(gsv.mappings,function(key,mapping) { 
				if((mapping.applicable == 0 || mapping.applicable == style))
				{
					mapping.setDefault()
				}
		});
		
		
	}
	else
	{
		//if the style change we really need to reset overrides even if it is not visible to the end user
		var overrides = (new scenario("",style)).getOverrides()
		$("#idInput").val(overrides)
	}
	
	if(style == 1)
	{
		$( "#idDivForward" ).show()
	}
	else if (style == 2)
	{
		$( "#idDivReverse" ).show()
	}
	else if (style == 3)
	{
		$( "#idDivBCJ" ).show()
	}
	
}
function getSelScen()
{
	var scenario = GUIStateVariables().scenarios[$("#scenariosSelect").val()]
	return scenario
}
function getExportStr(manmode)
{
	var gsv = GUIStateVariables()
	var uriarr = []
	
	var currentscen = getSelScen()
	
	var uri = new URI();
	uri.search(""); 
	
	$.each(gsv.mappings,function(key,mapping) {
		var uriadd = mapping.getURIVar()
		if(uriadd && (mapping.applicable == 0 || mapping.applicable == currentscen.style ))
		{
			uriarr.push(uriadd)
		}
	})
	
	if(manmode === undefined || manmode == 0)
	{
		uriarr.push("e")
	}
	else {
		uriarr.push("x")
	}
	return uri+"?"+uriarr.join("&")
}
function saveStr()
{
	$("#idURLStr").val(getExportStr())
}
function scenario(name,style)
{
	this.name = name
	this.style = style
	this.retention = 14
	this.size = 1000
	this.compression = 50
	this.changeRate = 10
	this.synthetic = [0,0,0,0,0,0,0]
	this.activeWeeklyInc = [0,0,0,0,0,0,0]
	this.activeWeeklyRev = [0,0,0,0,0,0,0]
	this.activeMonthlyInc = [0,0,0,0,0,0,0,0,0,0,0,0]
	this.activeMonthlyRev = [0,0,0,0,0,0,0,0,0,0,0,0]
	this.GFS = {"W":0,"M":0,"Q":0,"Y":0}
	this.dataGrowth = 0
	this.dataGrowthRate = 10
	this.dataGrowthYear = 1
	this.interval = "D"
	this.hiddenOverrides = ""
	this.getOverrides = function() {
		var overrides = "gsv.pureEngine.loglevel = 0"
		if(this.hiddenOverrides != "")
		{
			overrides += this.hiddenOverrides
		}
		return overrides
	}
	this.isURIScenario = false
}
function scenarios()
{
	var scenariosLocal =  {}
	
	var scenarioObj = new scenario("Forever Incremental",1)
	scenariosLocal[scenarioObj.name] = scenarioObj
	
	scenarioObj = new scenario("Incremental Weekly Synthetic",1)
	scenarioObj.synthetic[5] = 1
	scenariosLocal[scenarioObj.name] = scenarioObj
	
	scenarioObj = new scenario("Incremental Weekly Active Full",1)
	scenarioObj.activeWeeklyInc[5] = 1
	scenariosLocal[scenarioObj.name] = scenarioObj
	
	scenarioObj = new scenario("Incremental Monthly Active Full",1)
	scenarioObj.activeMonthlyInc = [1,1,1,1,1,1,1,1,1,1,1,1]
	scenariosLocal[scenarioObj.name] = scenarioObj
	
	scenarioObj = new scenario("Reverse Incremental",2)
	scenariosLocal[scenarioObj.name] = scenarioObj
	
	scenarioObj = new scenario("Reverse Incremental  Weekly Active Full",2)
	scenarioObj.activeWeeklyRev[5] = 1
	scenariosLocal[scenarioObj.name] = scenarioObj
	
	scenarioObj = new scenario("Reverse Incremental  Monthly Active Full",2)
	scenarioObj.activeMonthlyRev  = [1,1,1,1,1,1,1,1,1,1,1,1]
	scenariosLocal[scenarioObj.name] = scenarioObj
	
	scenarioObj = new scenario("Backup Copy Job",3)
	scenarioObj.retention = 7
	scenariosLocal[scenarioObj.name] = scenarioObj
	
	scenarioObj = new scenario("Backup Copy Job GFS 4W/4M/4Q/1Y",3)
	scenarioObj.retention = 7
	scenarioObj.GFS = {"W":4,"M":4,"Q":4,"Y":1}
	scenariosLocal[scenarioObj.name] = scenarioObj
	
	return scenariosLocal
}
function mapping(id,variable,applicable)
{
	this.id = id
	this.variable = variable
	this.puremap = variable
	this.applicable = applicable
	this.urivar = 0

	this.guival = function() {
		return $(this.id).val()
	}
	this.getURIVar = function()
	{
		var urivar = this.urivar
		if(urivar != 0)
		{
			urivar = urivar+"="+this.guival()
		}
		return urivar
	}

	this.copySwitch = 0
	
	this.convert = function() {
		return
	}
	this.setDefault = function() {
		return
	}
}
function mappings()
{
	var mappingsLocal = {}
	
	//default convertors 
	var convertSelectInt = function() {
		var selected = $(this.id+" option:selected").val()
		return parseInt(selected)
	}
	var convertSelectFloat = function() {
		var selected = $(this.id+" option:selected").val()
		return parseFloat(selected)
	}
	var convertInt = function() {
		return parseInt($(this.id).val())
	}
	//default uri mappers
	
	//defining mappings
	var setDefaultSelect = function() {
		var scenario = mappingsLocal["scenario"].convert()
		var value = scenario[this.variable]
		var jqselect = this.id
		
		if ( $(jqselect+" option[value='"+value+"']").length == 0 ){
			var urioption = new Option("Custom "+value+"", value)
			urioption.setAttribute("selected","selected")
			document.getElementById(jqselect.substring(1)).add(urioption);
		}
		else
		{
			$(jqselect+" option[value='"+value+"']").prop('selected',true);
		}
	}
	var setDefaultSelectInt = setDefaultSelect
	
	
	var mappingObj = new mapping("#scenariosSelect","scenario",-1)
	mappingObj.convert = function() {
		var scenario = GUIStateVariables().scenarios[$(this.id).val()]
		return scenario
	}
	mappingsLocal[mappingObj.variable] = mappingObj
	
	mappingObj = new mapping("#idStyle","style",0)
	mappingObj.urivar = "m"
	mappingObj.convert = convertInt
	mappingObj.setDefault = function() {
		var scenario = mappingsLocal["scenario"].convert()
		 $("#idStyle option[value='"+scenario.style+"']").prop('selected',true);
	}
	mappingsLocal[mappingObj.variable] = mappingObj
	
	mappingObj = new mapping("#idInput","overrides",0)
	mappingObj.convert = function() { 
		return $(this.id).val()
	}
	mappingObj.setDefault = function() {
		var scenario = mappingsLocal["scenario"].convert()
		 $(this.id).val(scenario.getOverrides())
	}
	mappingsLocal[mappingObj.variable] = mappingObj
		
	
	mappingObj = new mapping("#idData","size",0)
	mappingObj.urivar = "s"
	mappingObj.copySwitch = 1
	mappingObj.convert = function () { return (parseInt($(this.id).val())*1024*1024*1024) }
	mappingObj.setDefault = function() {
		var scenario = mappingsLocal["scenario"].convert()
		$(this.id).val(scenario.size)
	}
	mappingsLocal[mappingObj.variable] = mappingObj
	
	mappingObj = new mapping("#idRP","retention",0)
	mappingObj.urivar = "r"
	mappingObj.copySwitch = 1
	mappingObj.convert = convertInt
	mappingObj.setDefault = function() {
		var scenario = mappingsLocal["scenario"].convert()
		 $(this.id).val(scenario.retention)
	}
	mappingsLocal[mappingObj.variable] = mappingObj	

	mappingObj = new mapping("#idCompression","compression",0)
	mappingObj.urivar = "c"
	mappingObj.copySwitch = 1
	mappingObj.convert = convertSelectInt
	mappingObj.setDefault = setDefaultSelectInt
	mappingsLocal[mappingObj.variable] = mappingObj	
	
	mappingObj = new mapping("#idDelta","changeRate",0)
	mappingObj.urivar = "d"
	mappingObj.copySwitch = 1
	mappingObj.convert = convertSelectInt
	mappingObj.setDefault = setDefaultSelectInt
	mappingsLocal[mappingObj.variable] = mappingObj	
	
	//Interval Mapping
	mappingObj = new mapping("#idInterval","interval",0)
	mappingObj.urivar = "i"
	mappingObj.getURIVar = function()
	{
		return this.urivar+"="+$(this.id+" option:selected").val()
	}
	mappingObj.convert = function() {
		var intervalSelected = $(this.id+" option:selected").val()
		var returnValue = {days:1}
		if(!isNaN(intervalSelected))
		{
			returnValue = {hours:intervalSelected}
		}

		return returnValue
	}
	mappingObj.setDefault = function() {
		var scenario = mappingsLocal["scenario"].convert()
		var testOption = $(this.id).find('option[value="'+scenario.interval+'"]')
		if(testOption && testOption.prop)
		{
			testOption.prop('selected', true)
		}
	}
	mappingsLocal[mappingObj.variable] = mappingObj	

	//Start Mapping
	mappingObj = new mapping("#idStart","start",0)
	mappingObj.convert = function() {
		var startSelected = $(this.id+" option:selected").val()
		var returnValue = moment().add({days:1}).startOf('day').add({hours:22});
		if(startSelected == "FirstOfMonth" )
		{
			returnValue = moment().startOf('month').add({months:1}).add({hours:22});
		}
		else if(startSelected == "FirstOfYear" )
		{
			returnValue = moment().add({years:1}).startOf('year').add({hours:22});
		}
		
		return returnValue
	}
	mappingsLocal[mappingObj.variable] = mappingObj	
	
	//DataGrowth Mappings
	mappingObj = new mapping("#idDataGrowthRate","dataGrowthRate",0)
	mappingObj.urivar = "dgr"
	mappingObj.copySwitch = 1
	mappingObj.convert = convertSelectInt
	mappingObj.setDefault = setDefaultSelectInt
	mappingsLocal[mappingObj.variable] = mappingObj	
	
	mappingObj = new mapping("#idDataGrowthYear","dataGrowthYear",0)
	mappingObj.urivar = "dgy"
	mappingObj.copySwitch = 1
	mappingObj.convert = convertSelectFloat
	mappingObj.setDefault = setDefaultSelect
	mappingsLocal[mappingObj.variable] = mappingObj	
	
	mappingObj = new mapping("#idDataGrowth","dataGrowth",0)
	mappingObj.convert = function() { return $(this.id).is(':checked') }
	mappingObj.urivar = "dg"
	mappingObj.copySwitch = 1
	mappingObj.guival = function() {
		return ($(this.id).is(':checked')?1:0)
	}
	mappingObj.setDefault = function() {
		var scenario = mappingsLocal["scenario"].convert()
		var value = scenario[this.variable]
		var jqselect = this.id
		
		if(value == 1)
		{
			$(jqselect).prop("checked",true)
		}
		else 
		{
			$(jqselect).prop("checked",false)
		}
	}
	mappingsLocal[mappingObj.variable] = mappingObj
		
	
	
	var checkboxUncheck = function()
	{
		$.each($("input[id^="+this.id+"]"), function(key,checkbox) {
			$(checkbox).prop("checked",false)
		})
		var scenario = mappingsLocal["scenario"].convert()
		
		var mappingObj = this
		
		$.each(scenario[this.variable],function (day,enabled) {
			if(enabled) {
				$("#"+mappingObj.id+day).prop("checked",true)
			}
		})
	}
	var checkboxConvert = function()
	{
		
		var scenario = mappingsLocal["scenario"].convert()
		var mappingObj = this
		
		var arrayChecks = scenario[mappingObj.variable].slice()
		
		$.each(arrayChecks,function (index,val) {
			if($("#"+mappingObj.id+index).is(":checked"))
			{
				arrayChecks[index] =  1
			}
			else
			{
				arrayChecks[index] = 0
			}
		})
		return arrayChecks
	}
	
	var checkboxUri = function()
	{
		
		var scenario = mappingsLocal["scenario"].convert()
		var mappingObj = this
		var toReturn = 0
		
		var arrayChecks = scenario[mappingObj.variable].slice()
		
		var flagged = false
		$.each(arrayChecks,function (index,val) {
			if($("#"+mappingObj.id+index).is(":checked"))
			{
				arrayChecks[index] =  1
				flagged = true
			}
			else
			{
				arrayChecks[index] = 0
			}
		})
		if (flagged)
		{
			toReturn = this.urivar+"="+arrayChecks.join(",")
		}
		return toReturn
	}
	
	mappingObj = new mapping("fullcheckbox-synday","synthetic",1)
	mappingObj.urivar = "sy"
	mappingObj.getURIVar = checkboxUri
	mappingObj.setDefault = checkboxUncheck
	mappingObj.convert = checkboxConvert
	mappingsLocal[mappingObj.variable] = mappingObj	
	
	
	mappingObj = new mapping("fullcheckbox-incractday","activeWeeklyInc",1)
	mappingObj.urivar = "iw"
	mappingObj.getURIVar = checkboxUri
	mappingObj.setDefault = checkboxUncheck
	mappingObj.convert = checkboxConvert
	mappingObj.puremap = "activeWeek"
	mappingsLocal[mappingObj.variable] = mappingObj	
	
	mappingObj = new mapping("fullcheckbox-incractmonth","activeMonthlyInc",1)
	mappingObj.urivar = "im"
	mappingObj.getURIVar = checkboxUri
	mappingObj.setDefault = checkboxUncheck
	mappingObj.convert = checkboxConvert
	mappingObj.puremap = "activeMonths"
	mappingsLocal[mappingObj.variable] = mappingObj	
	
	
	mappingObj = new mapping("fullcheckbox-revactday","activeWeeklyRev",2)
	mappingObj.urivar = "rw"
	mappingObj.getURIVar = checkboxUri
	mappingObj.setDefault = checkboxUncheck
	mappingObj.convert = checkboxConvert
	mappingObj.puremap = "activeWeek"
	mappingsLocal[mappingObj.variable] = mappingObj	
	
	mappingObj = new mapping("fullcheckbox-revactmonth","activeMonthlyRev",2)
	mappingObj.urivar = "rm"
	mappingObj.getURIVar = checkboxUri
	mappingObj.setDefault = checkboxUncheck
	mappingObj.convert = checkboxConvert
	mappingObj.puremap = "activeMonths"
	mappingsLocal[mappingObj.variable] = mappingObj	
	
	
	mappingObj = new mapping("idGFS","GFS",3)
	mappingObj.univar = "g"
	mappingObj.getURIVar = function() {
		var tmpGFS = [0,0,0,0]
		$.each({0:"W",1:"M",2:"Q",3:"Y"}, function (key,val) {
			tmpGFS[key] = parseInt($("#"+mappingObj.id+val).val())
		})
		return "g="+tmpGFS.join(",")
	}
	mappingObj.setDefault = function() {
		var scenario = mappingsLocal["scenario"].convert()
		var mappingObj = this
		
		$.each(scenario.GFS, function(key,preset) {
			$("#"+mappingObj.id+key).val(preset)
		})
	}
	mappingObj.convert = function() {
		var mappingObj = this
		var GFSSettings =  {"W":0,"M":0,"Q":0,"Y":0}
		
		$.each(GFSSettings, function(key,preset) {
			GFSSettings[key] = parseInt($("#"+mappingObj.id+key).val())
		})
		
		return GFSSettings
	}
	mappingsLocal[mappingObj.variable] = mappingObj	
	
	return mappingsLocal
}
function GUIStateVariables()
{
	var GUIState = 0
	
	
	if(!window.GUIStateVariablesStore3b0f40f082684c88811ca35e18b70ed3)
	{
		GUIState = {}
		GUIState.mappings = mappings()
		GUIState.scenarios = scenarios()
		GUIState.pureEngine = VeeamPureEngine()
		GUIState.backupResult = VeeamBackupResultObject()
		window.GUIStateVariablesStore3b0f40f082684c88811ca35e18b70ed3 = GUIState
	}
	else
	{
		GUIState = window.GUIStateVariablesStore3b0f40f082684c88811ca35e18b70ed3
	}
	return GUIState
}
function gfxTable()
{
	this.tbody =  document.createElement("tbody");  
	this.lasttr = document.createElement("tr"); 
	this.lastel = this.lasttr
	this.lasta = document.createElement("a");
	
	this.tbody.appendChild(this.lasttr)
	
	this.tr = function() {
		this.lasttr = document.createElement("tr");
		this.lastel = this.lasttr
		this.tbody.appendChild(this.lasttr)
		return this
	}
	this.attr = function(aname,avalue) {
		this.lastel.setAttribute(aname,avalue)
		return this
	}
	
	this.td = function(text) {
		var td = document.createElement("td");
		var t = document.createTextNode(text);
		td.appendChild(t)
		this.lasttr.appendChild(td)
		this.lastel = td
		return this	
	}
	this.a = function(text) {
		var td = document.createElement("td");
		var a = document.createElement("a");
		a.setAttribute("href","#")
		var t = document.createTextNode(text);
		
		a.appendChild(t)
		td.appendChild(a)

		this.lasttr.appendChild(td)
		this.lastel = td
		this.lasta = a
		return this	
	}	
	this.href = function(href) {
		this.lasta.setAttribute("href",href)
		return this
	}
	this.img = function(src) {
		var td = document.createElement("td");
		var img = document.createElement("img");
		img.setAttribute("src",src)
		td.appendChild(img)
		this.lasttr.appendChild(td)
		this.lastel = td
		return this
	}
	
	this.gettbody = function() {
		return this.tbody
	}
	
	return this
}
function humanReadableFilesize(valueIn)
{
	return  humanReadableFilesizeWithForce(valueIn,0)
}
function humanReadableFilesizeWithForce(valueIn,e)
{
	var forcesuffix = 0
	if(e)
	{
		forcesuffix = e
	}
	return filesize(valueIn, {base: 2,round: 2,forcesuffix:forcesuffix})
}
function renderCanvas(backupResult,showWorstCase)
{
	var jd = $("#idDivResultCanvas")
	jd.hide()
	var c = document.getElementById("idRenderCanvas")
	var igfs = document.getElementById("idimagegfs")
	var imagearrowdown = document.getElementById("idimagearrowdown")
	var imagearrowup = document.getElementById("idimagearrowup")
	
	
	var files = backupResult.getWorstCaseFiles()
	var filesizeTotalRaw =  backupResult.worstCaseSize
	var workingSpaceRaw = backupResult.worstCaseDayWorkingSpace
	var grandTotalRaw =  backupResult.worstCaseSizeWithWorkingSpace
	
	if(!showWorstCase) {
		files = backupResult.getFiles()
		filesizeTotalRaw =  backupResult.totalSize
		workingSpaceRaw = backupResult.workingSpace
		grandTotalRaw =  backupResult.totalSize+backupResult.workingSpace
	}
	
	var prelogicvar = prelogic(files)
	var unifiedeval = prelogicvar.unifiedeval
	

	var filesizeTotal =  humanReadableFilesizeWithForce(filesizeTotalRaw,unifiedeval)
	var workingSpace = humanReadableFilesizeWithForce(workingSpaceRaw,unifiedeval)
	var grandTotal =  humanReadableFilesizeWithForce(grandTotalRaw,unifiedeval)
	
	
	var margin = 5
	var fileheight = 20
	var incwidth = 30
	var fullwidth = 120
	var margindoc = 10
	var colsyn = ["#aed9a5","#bfe1b8"]
	var colactive = ["#ff9955","#ffb380"]
	var colgfs = ["#656565","#757575"]
	var triangleLinkSize = 15
	var totalsum = 54+25

	var charwidth = 12
	var retentionspace = charwidth*prelogicvar.sretstring
	
	ctx = c.getContext("2d");
	ctx.clearRect(0, 0, c.width, c.height);
	
	c.width = margin*2+retentionspace+fullwidth+350
	c.height = files.length*(fileheight+margin)+totalsum+margindoc*2
	
	var t = function(ctx,txt,x,y,color) {
		var fs = 16
		ctx.beginPath(); 
		ctx.font = fs+"px Verdana";
		ctx.fillStyle="#333333"
		if(color !== undefined) {
			ctx.fillStyle=color
		}
		
		ctx.fillText(txt,x,y+fs);
	}
	
	//thrust me, I'm an engineer it took hours calculating an arrow and rectangles, don't try to understand unless you really want to
	var link = function(ctx,x,y,up) {
		if(up) {
			ctx.drawImage(imagearrowup,x,y);
		}
		else {
			ctx.drawImage(imagearrowdown,x,y+2);
		}
	}	
	
	
	$.each(files,function(i,f) {
		var x = margindoc+retentionspace
		var y = margindoc+(i*(fileheight+margin))
		var width = (f.isVBK()?fullwidth:incwidth)
		var color = ((f.type == "F")?colactive:((f.type == "G")?colgfs:colsyn))

		t(ctx,f.toSimpleRetentionString(),margindoc,y)
		t(ctx,f.file,margindoc+retentionspace+fullwidth+10,y)
		t(ctx,humanReadableFilesizeWithForce(f.getDataStats().f(),unifiedeval),margindoc+retentionspace+fullwidth+200,y)
		
		if(!f.isVBK()) {
			link(ctx,x,y,(f.type == "I")?1:0)
			x = x+triangleLinkSize
		}
		
		ctx.beginPath(); 
		ctx.fillStyle=color[0];	
		ctx.fillRect(x,y,width,fileheight);
		
		if (f.type == "G") {
			 ctx.drawImage(igfs,x+5,y+3);
		}
		else {
			var tm = 2
			ctx.beginPath();
			ctx.moveTo(x+tm,y+tm);
			ctx.lineTo(x+tm,y+fileheight-tm);
			ctx.lineTo(x+fileheight,y+fileheight-tm);
			ctx.closePath();
			ctx.fillStyle=color[1];
			ctx.fill();
		}
		
	})
	var sumy = files.length*(fileheight+margin)+margindoc+4
	var sumx = margindoc+retentionspace+fullwidth+200
	
	ctx.beginPath(); 
	ctx.strokeStyle="#aaaaaa"
	ctx.moveTo(margindoc,sumy-2);
	ctx.lineTo(margindoc+retentionspace+fullwidth+300,sumy-2);
	ctx.stroke()
	
	ctx.beginPath(); 
	ctx.strokeStyle="#aaaaaa"
	ctx.moveTo(margindoc,sumy+50);
	ctx.lineTo(margindoc+retentionspace+fullwidth+300,sumy+50);
	ctx.stroke()
	
	
	t(ctx,"Total",margindoc,sumy)
	t(ctx,"Working Space",margindoc,sumy+25,"#aa3333")
	t(ctx,"Grand Total",margindoc,sumy+52)
	
	t(ctx,filesizeTotal,sumx,sumy)
	t(ctx,workingSpace,sumx,sumy+25,"#aa3333")
	t(ctx,"+",sumx-20,sumy+25,"#aa3333")
	t(ctx,grandTotal,sumx,sumy+52)
	
	
	
	//cause IE sucks and this is how it works 
	var datastream = (document.getElementById('idRenderCanvas').toDataURL('image/png'))
	document.getElementById('idimgrender').src = datastream;
	var ahref = document.getElementById('idahrefdownload')
	ahref.href = datastream
	ahref.download = "rpsout-"+moment().format("YYYYMMDDHHmmss")+".png"
	
	jd.show()
	
}
//dirty hacking so that all the filesize suffixes are the same
function prelogic(files) {
	var p = {
		unifiedeval:9,
		full:0,
		gfs:0,
		inc:0,
		retstring:5,
		sretstring:5
	}
	
	$.each(files,function(key,val) {
		var testeval = filesize(val.getDataStats().f(), {base: 2,round: 2,output: "e"})
		if (testeval < p.unifiedeval)
		{
			p.unifiedeval = testeval
		}
		if(val.isVBK()) {
			p.full += 1
		} else { 
			p.inc += 1 
		}
		var teststr = val.toRetentionString().length
		if( p.retstring < teststr)
		{
			p.retstring = teststr
		}
		teststr = val.toSimpleRetentionString().length
		if( p.sretstring < teststr)
		{
			p.sretstring = teststr
		}
	});
	return p
}
function renderGFX(backupResult,showWorstCase)
{
	var resultdiv = $("#idResult")
	var tableResult = $("#idTableResult")
	tableResult.empty()
	
	//
	
	var files = backupResult.getWorstCaseFiles()
	if(!showWorstCase)
	{
		files = backupResult.getFiles()
	}
	
	var prelogicvar = prelogic(files)
	
	var unifiedeval = prelogicvar.unifiedeval
	
	var filesizeTotalRaw =  backupResult.worstCaseSize
	var workingSpaceRaw = backupResult.worstCaseDayWorkingSpace
	var grandTotalRaw =  backupResult.worstCaseSizeWithWorkingSpace

	
	if(!showWorstCase)
	{
		filesizeTotalRaw = backupResult.getTotalSize()
		workingSpaceRaw = backupResult.getWorkSpace()
		grandTotalRaw =  (filesizeTotalRaw+workingSpaceRaw)
		
		if(backupResult.lastActionDate)
		{
			var tableShowHow = $("#idTableShowMeHow")
			tableShowHow.empty()
			
			var tableHow = new gfxTable()
			
			tableHow.td("Last Steps "+backupResult.lastActionDate.format("dd YYYY-MM-DD HH ")+"h").attr("class","laststeps")
			for(var counter=0;counter < backupResult.lastActions.length;counter = counter + 1 )
			{
				tableHow.tr().td(backupResult.lastActions[counter])
			}
			tableHow.tr().attr("style","height:100%").td("")
			tableShowHow.append(tableHow.gettbody())
		}
	}
	
	var filesizeTotal =  humanReadableFilesizeWithForce(filesizeTotalRaw,unifiedeval)
	var workingSpace = humanReadableFilesizeWithForce(workingSpaceRaw,unifiedeval)
	var grandTotal =  humanReadableFilesizeWithForce(grandTotalRaw,unifiedeval)
	
	
	var fulls = 0
	var incs = 0
	var fullmax = 0
	var incmax = 0
	var fulltotal = 0
	var inctotal = 0
	
	var table = new gfxTable()
	table.td("Retention").attr("class","widthpoint")
	table.td("").attr("class","widthpointvisual")
	table.td("File").attr("class","widthfile")
	table.td("Size").attr("class","widthsize")
	table.td("Modify Date").attr("class","widthdate")
	table.td("Point Date").attr("class","widthdate")
	
	for(var counter=0;counter < files.length;counter = counter + 1 )
	{
		var file = files[counter]
		table.tr().td(file.toRetentionString())
		var fs = file.getDataStats().f()
		
		if(file.isVBK())
		{
			fulls++
			if(fs > fullmax) { fullmax = fs }
			fulltotal += fs
			
			if(file.isGFS()) {
				table.img("rpsimg/gfs.png")
			}
			else if (file.type == "F")
			{
				//active full, type is S if synthetic
				table.img("rpsimg/active.png")
				
			}
			else
			{
				table.img("rpsimg/full.png")
			}
		}
		else
		{
			incs++
			if(fs >incmax) { incmax = fs }
			inctotal += fs
			
			if(file.type == "I")
			{
				table.img("rpsimg/inc-up-img2.png")
			}
			else
			{
				table.img("rpsimg/rev-down-img2.png")
			}
		}
		var hrfsize = humanReadableFilesizeWithForce(file.getDataStats().f(),unifiedeval)
		table.td(file.file).a(hrfsize).attr("onClick","showVisualData(["+file.getDataStats().sd()+","+file.getDataStats().f()+"]);return false;").td(file.modifyDate.format("YYYY-MM-DD dd HH")).td(file.pointDate.format("YYYY-MM-DD dd HH"))		
	}
	table.tr().td("").td("").td("").td(filesizeTotal).attr("class","totalTopLine").td("").td("")
	table.tr().td("").td("").td("Work Space").attr("class","alert").td("+"+workingSpace).attr("class","alert").td("").td("")
	
	//generating some object code here {"Fulls":fulls,"Incs":incs}
	var s = {
		cstring:"",
		a:function(key,text) { this.cstring = ((this.cstring == "")?"":this.cstring+",")+"'"+key+"':'"+text+"'";return this },
		g:function() {return "{"+this.cstring+"}"}
	}
	var gb = function (b) { return Math.ceil(b/1073741824) }
	s.a('Fulls',fulls)
	s.a('Incrementals',incs)
	s.a('Average Full Size',gb(fulltotal/fulls))
	s.a('Average Inc Size',gb(inctotal/incs))
	s.a('Max Full Size',gb(fullmax))
	s.a('Max Inc Size',gb(incmax))
	s.a('Total Filesize',gb(filesizeTotalRaw))
	s.a('Working Space',gb(workingSpaceRaw))
	s.a('Total',gb(grandTotalRaw))
	
	
	table.tr().td("").td("").td("").a(grandTotal).attr("class","totalTopLine").attr("onClick","showTable('Totals in GB',"+s.g()+");return false;").td("").td("")
	tableResult.append(table.gettbody())
	resultdiv.show()
	
	
}

function renderText(backupResult)
{
	var gsv = GUIStateVariables()
	if(backupResult.lastActionDate)
	{
		
		gsv.pureEngine.debugln("Last Steps "+backupResult.lastActionDate.format(),1)
		for(var counter=0;counter < backupResult.lastActions.length;counter = counter + 1 )
		{
				gsv.pureEngine.debugln("<< "+backupResult.lastActions[counter],1)
		}
	}
	else
	{
		gsv.pureEngine.debugln("no actions performed yet!",1)
	}
	
	gsv.pureEngine.debugln("",1)
	var files = backupResult.getFiles()
	for(var counter=0;counter < files.length;counter = counter + 1 )
	{
		gsv.pureEngine.debugln("(*) >> "+files[counter],1)
	}
	gsv.pureEngine.debugln("",1)
		
	gsv.pureEngine.debugln("(Worst Case) >> "+backupResult.toStringWorstCase(),1)
	files = backupResult.getWorstCaseFiles()
		
	for(var counter=0;counter < files.length;counter = counter + 1 )
	{
		gsv.pureEngine.debugln("(*) >> "+files[counter],1)
	}
		
	$("#idConsole").val(gsv.pureEngine.log.join("\n"))
}

function manualrun(steps)
{
	manualrunDirect(steps,false)
}
function manualrunDirect(steps,simulateButton)
{
	var gsv = GUIStateVariables()
	gsv.pureEngine.clearlog()
	
	var showmehowconsole = $("#idShowMeHowConsole")
	var showmehowresult = $("#idShowMeHowResult")
		
	showmehowconsole.hide()

	if(gsv.backupResult && gsv.currentMoment && gsv.interval && gsv.backupConfiguration)
	{
		var end = gsv.currentMoment.clone()
		for(var i=0;i<steps;i = i +1)
		{
			end.add(gsv.interval)
		}
		
		eval($("#idInput").val());
		gsv.pureEngine.debugln("engine start",1)
		gsv.pureEngine.run(gsv.backupConfiguration,gsv.backupResult,gsv.currentMoment,gsv.interval,end)
		gsv.pureEngine.debugln("engine ended",1)	
	
		renderText(gsv.backupResult)	
		renderGFX(gsv.backupResult,false)
		
		gsv.currentMoment = end
		
		
		
		showmehowconsole.show().draggable()
		if(simulateButton)
		{
			showmehowconsole.animate({left:0,top:0})
		}
		showmehowresult.show();

	}
	
	

}

function simulate()
{
	var gsv = GUIStateVariables()
	
	$("#idResult").hide()
	$("#idDivResultCanvas").hide()
	
	var showmehow = $("#idShowMeHowCheck").is(":checked")
	var showmehowconsole = $("#idShowMeHowConsole")
	var showmehowresult = $("#idShowMeHowResult")
	
	var canvasrendering = $('#idShowCanvas').is(':checked')
	
	showmehowconsole.hide()
	showmehowresult.hide()

	
	gsv.pureEngine.reset()
	var backupResult = VeeamBackupResultObject()
	
	var sourceSize = gsv.mappings["size"].convert()
	var backupstyle = gsv.mappings["style"].convert()
	var retention = gsv.mappings["retention"].convert()
	var backupConfiguration = VeeamBackupConfigurationObject(backupstyle,retention,sourceSize);

	backupConfiguration["changeRate"] = gsv.mappings["changeRate"].convert()
	backupConfiguration["compression"] = gsv.mappings["compression"].convert()
	
	$.each(gsv.mappings,function(key,mapping) {
		if(mapping.applicable == backupstyle)
		{
			backupConfiguration[mapping.puremap] = gsv.mappings[mapping.variable].convert()
		}
	});
	
	var interval = gsv.mappings["interval"].convert()
	//var start = gsv.mappings["start"].convert()
	var start = moment().add({days:1}).startOf('day').add({hours:22});
	
	
	var datagrowthrate = gsv.mappings["dataGrowthRate"].convert()
	var datagrowthyears = gsv.mappings["dataGrowthYear"].convert()
	var datagrowthenabled = gsv.mappings["dataGrowth"].convert()
	
	if(datagrowthenabled)
	{
		backupConfiguration.simpleYearGrowth = datagrowthrate
	} else { backupConfiguration.simpleYearGrowth = 0 }
	var exporturl = getExportStr()
	
	if(!showmehow)
	{
		gsv.backupConfiguration = backupConfiguration
		gsv.backupResult = backupResult
		gsv.showWorstCase = true

	
		var end = start.clone()
		

		var showlatest = $('#idShowLatest').val()
		if(showlatest == "1") {
			gsv.showWorstCase = false
		}
		
		var ttconvert = function (val) {
			var ret = 0
			if (val != "0" && val != "") {
				convert = moment(val)
				if (convert.year() > 2000) {
					return convert
				}
			}
			return ret
		}
		manStart = ttconvert($('#idManStart').val())
		manStop = ttconvert($('#idManStop').val())
		if (manStart!= 0) {
			start = manStart
		}
		
		if(manStop != 0) {
			end = manStop
		} else {
			end = start.clone().add(datagrowthyears,'years')
			if(!datagrowthenabled)
			{
				end = gsv.pureEngine.predictEndDate(backupConfiguration,start.clone(),interval)
			}
		} 
		
		//alert("Start :: "+start.format()+" End :: "+end.format())
		eval($("#idInput").val());
		gsv.pureEngine.debugln("engine start",1)
		gsv.pureEngine.run(backupConfiguration,backupResult,start,interval,end)
		gsv.pureEngine.debugln("engine ended",1)

		renderText(backupResult)
		if(canvasrendering)
		{
			renderCanvas(backupResult,gsv.showWorstCase)
		}
		else
		{
			renderGFX(backupResult,gsv.showWorstCase)
		}
		

		
		
	}
	else
	{
		gsv.backupResult = backupResult
		gsv.currentMoment = start
		gsv.interval = interval
		gsv.backupConfiguration = backupConfiguration
		
		manualrunDirect(1,true)
		exporturl = getExportStr(1)
	}
	
	$("#idExportStr").val(exporturl)
}

function selectScenario(urlswitch)
{
	var gsv = GUIStateVariables()
	var selectedScenario = gsv.scenarios[$("#scenariosSelect option:selected").val()]
	
	if(!urlswitch)
	{
		$.each(gsv.mappings, function(mparam,mapping) {
			if(mapping.copySwitch)
			{
				selectedScenario[mparam] = mapping.guival()
			}
		})
	}
	showInputs(selectedScenario.style)
	
}
function checkboxURIParameter(instring,size)
{
	var points = new Array(size);
	
	
	$.each(points,function(key,val) {
		points[key] = 0
	});
	var splitstr = instring.split(",")
	if(splitstr.length > 0 && splitstr.length <= size)
	{
		$.each(splitstr, function(key,val) {
			var tmptest = parseInt(val)
			
			if(!isNaN(tmptest) && tmptest == 1)
			{
				points[key] = 1
			}
		})
	}
	
	return points
}

function checkURIParameter(scenario,getmap,uriparam,scenariovar,parseFunction)
{
	if(uriparam in getmap)
	{
		if(parseFunction)
		{
			
			scenario[scenariovar] =  parseFunction(getmap[uriparam],scenario)
		}
		else
		{
			scenario[scenariovar] = getmap[uriparam]
		}
		scenario.isURIScenario = true
	}
}
$( document ).ready(function() {
	var gsv = GUIStateVariables()
	$("#idInput").val("gsv.pureEngine.loglevel = 0")
	$("#idConsole").val("")
	
	var uri = new URI();
	var getmap = uri.search(true);
	
	var uriscenario = new scenario("URL Parameters",1)
	var intfunction = function(intcheck,scenario) { var toReturn = parseInt(intcheck); if(isNaN(toReturn)) { toReturn = 1 };return toReturn }
	var floatfunction = function(floatcheck,scenario) { var toReturn = parseFloat(floatcheck); if(isNaN(toReturn)) { toReturn = 1 };return toReturn }
	
	checkURIParameter(uriscenario,getmap,"s","size",intfunction)
	checkURIParameter(uriscenario,getmap,"r","retention",intfunction)
	checkURIParameter(uriscenario,getmap,"d","changeRate",intfunction)
	checkURIParameter(uriscenario,getmap,"c","compression",intfunction)
	checkURIParameter(uriscenario,getmap,"i","interval",0)
	checkURIParameter(uriscenario,getmap,"m","style",function(intcheck,scenario) {
		var toReturn = parseInt(intcheck); 
		if(isNaN(toReturn) || toReturn < 1 || toReturn > 3) { 
			toReturn = 1 
		};
		return toReturn
	})
	checkURIParameter(uriscenario,getmap,"g","GFS",function(GFSSplit,scenario) {
		var toReturn = {"W":0,"M":0,"Q":0,"Y":0}
		var GFSSplit = GFSSplit.split(",")
		
		$.each({0:"W",1:"M",2:"Q",3:"Y"}, function (key,val) {
			if (key < GFSSplit.length)
			{
				var testval = parseInt(GFSSplit[key])
				if(!isNaN(testval))
				{
					toReturn[val] = testval
				}
			}
		})
		return toReturn
	})
	/*
		this.synthetic = [0,0,0,0,0,0,0]
		this.activeWeeklyInc = [0,0,0,0,0,0,0]
		this.activeWeeklyRev = [0,0,0,0,0,0,0]
		this.activeMonthlyInc = [0,0,0,0,0,0,0,0,0,0,0,0]
		this.activeMonthlyRev = [0,0,0,0,0,0,0,0,0,0,0,0]
	*/
	checkURIParameter(uriscenario,getmap,"sy","synthetic",function(arraystring,scenario) { return checkboxURIParameter(arraystring,7) })
	checkURIParameter(uriscenario,getmap,"iw","activeWeeklyInc",function(arraystring,scenario) { return checkboxURIParameter(arraystring,7)})
	checkURIParameter(uriscenario,getmap,"im","activeMonthlyInc",function(arraystring,scenario) { return checkboxURIParameter(arraystring,12)})
	checkURIParameter(uriscenario,getmap,"rw","activeWeeklyRev",function(arraystring,scenario) { return checkboxURIParameter(arraystring,7)})
	checkURIParameter(uriscenario,getmap,"rm","activeMonthlyRev",function(arraystring,scenario) { return checkboxURIParameter(arraystring,12)})
	checkURIParameter(uriscenario,getmap,"dg","dataGrowth",function(enablestring,scenario) {
		var toReturn = parseInt(enablestring); if(isNaN(toReturn)) { toReturn = 0 };return toReturn
	})
	checkURIParameter(uriscenario,getmap,"dgy","dataGrowthYear",floatfunction)
	checkURIParameter(uriscenario,getmap,"dgr","dataGrowthRate",intfunction)

	
	//legacy parameters
	checkURIParameter(uriscenario,getmap,"used","size",intfunction)
	checkURIParameter(uriscenario,getmap,"rp","retention",intfunction)
	checkURIParameter(uriscenario,getmap,"delta","changeRate",intfunction)
	checkURIParameter(uriscenario,getmap,"fullsave","compression",intfunction)
	checkURIParameter(uriscenario,getmap,"incsave","hiddenOverrides",function(intcheck,scenario) { 
		var toReturn = scenario.hiddenOverrides; 
		if(!isNaN(parseInt(intcheck))) { toReturn += ";gsv.backupConfiguration['compressionDelta'] = "+intcheck;alert("The incsave is a legacy uri parameter and will only work for this specific url scenario, when you change style manually, it will be disabled. \nTry to avoid!") };return toReturn })
	checkURIParameter(uriscenario,getmap,"strat","style",function(testval) { var toReturn = 1;if(testval == "rev") { toReturn = 2 } else if(testval == "bcj") { toReturn = 3 };return toReturn})
	checkURIParameter(uriscenario,getmap,"hourly","interval",function(testval) { var toReturn = parseInt(testval);if(isNaN(toReturn)) { toReturn = "D" };return toReturn})

	
	if(uriscenario.isURIScenario)
	{
		gsv.scenarios[uriscenario.name] = uriscenario
	}

	var scenariosSelect = $("#scenariosSelect");
	$.each(gsv.scenarios, function(key,val) {
			if(val.isURIScenario)
			{
				var urioption = new Option(key, key)
				urioption.setAttribute("selected","selected")
				scenariosSelect.append(urioption);
				
			}
			else
			{
				scenariosSelect.append(new Option(key, key));
			}
	});

	
	
	selectScenario(true)
	
	scenariosSelect.change(function() {
		selectScenario(false)
	})
	$("#idStyle").change(function() {
		showInputsWithDefaults($("#idStyle option:selected").val(),false)
	})
	if("dev" in getmap)
	{
		$('#idDivDev').show();
	}
	if("reversesim" in getmap) {
		var m = moment().hour(8).minute(0).second(0);
		var stop = m.format("YYYY-MM-DD HH:mm:ss");
		var start = m.subtract(3, 'years').hour(20).format("YYYY-MM-DD HH:mm:ss");
		$('#idManStart').val(start)
		$('#idManStop').val(stop)
		$('#idShowLatest').val(1)
		$('#idDivDev').show();
	}
	if("devline" in getmap)
	{
		$("#idInput").val($("#idInput").val()+getmap["devline"].replace(/^("|')/,"").replace(/("|')$/,""))
	}
	if("engine" in getmap)
	{
		var engineflags = getmap["engine"].split(",")
		$.each(engineflags, function (key,val) {
			if ( val in gsv.pureEngine.flags)
			{
				gsv.pureEngine.flags[val] = true
			}
		});
	}
	var manexec = function(getmap,urlparam) {
		if (urlparam in getmap)
		{
			$("#idShowMeHowCheck").prop('checked', true);
			simulate()
			
			if(getmap[urlparam])
			{
				
				runs = parseInt(getmap[urlparam])
				if(!isNaN(runs) && runs > 0)
				{
					//simulate will set parameters and will run 1 time
					manualrun(runs-1);
				}
			}
		}
	}
	
	if("man" in getmap) { manexec(getmap,"man")}
	else if ("x" in getmap) { manexec(getmap,"x")}
	else if ("exec" in getmap || "e" in getmap)
	{
		simulate()
	}


	toggleDataGrowth()
	toggleExport()
	toggleCanvas()
});








function toggleExport() {
	var j=$('#idExportTR');
	if($('#idShowExport').is(':checked')){
		j.show()
	} else{
		j.hide()
	};
	return false;
}

function toggleDataGrowth()
{
	var toggle = $('#idDataGrowth').is(':checked')
	var manrundisabled = !$('#idShowMeHowCheck').is(':checked')
	
	$('#idDataGrowthRate').prop('disabled',!toggle)
	$('#idDataGrowthYear').prop('disabled',!(toggle && manrundisabled))
}
function toggleCanvas() {
	var toggle = $('#idShowCanvas').is(':checked')
	var man=$('#idShowMeHowCheck');
	
	
	if(toggle) {
		man.prop('disabled',true)
		man.prop('checked',false)
		toggleDataGrowth()
	}
	else {
		man.prop('disabled',false)
	}
}

function showJS()
{
	var table = new gfxTable()
	var tableResult = $("#idTablePopUpDiv")
	tableResult.empty()
	text = [
		{txt:"jQuery",link:"http://jquery.com/"},
		{txt:"jQuery UI",link:"http://jqueryui.com/"},
		{txt:"MomentJS",link:"http://momentjs.com/"},
		{txt:"FilesizeJS",link:"http://filesizejs.com/"},
		{txt:"URI.js",link:"http://medialize.github.io/URI.js/"},
	]
	table.td("RPS wouldn't be possible without these frameworks:")
	$.each(text,function(index,line) {
		table.tr().a(line.txt).href(line.link)
	})
	tableResult.append(table.gettbody())
	$("#idPopUpDiv").show()
}
function showTable(title,text)
{
	var table = new gfxTable().td(title).attr("style","font-size:x-large;")
	var tableResult = $("#idTablePopUpDiv")
	tableResult.empty()
	
	$.each(text,function(label,text) {
		table.tr().td(label).td(text)
	})
	
	tableResult.append(table.gettbody())
	$("#idPopUpDiv").show()
}
function showHelp(title,text)
{
	var table = new gfxTable().td(title).attr("style","font-size:x-large;")
	var tableResult = $("#idTablePopUpDiv")
	tableResult.empty()
	
	$.each(text,function(index,line) {
		if(index !=0) { table.tr().td("").attr("style","height:2px;") }
		table.tr().td(line)
	})
	
	tableResult.append(table.gettbody())
	$("#idPopUpDiv").show()
}
function showVisualData(datasize)
{
		var table = new gfxTable().td("Data \\ Time").attr("class","grey")
		var tableResult = $("#idTablePopUpDiv")
		tableResult.empty()
		
		var hoursarr = [1,4,8,12,16,24]
		$.each(hoursarr,function (key,hours) {
				table.td(hours+(hours == 1 ? " hour":" hours")).attr("class","grey")
		})
		
		fround = 1
		
		fsizeparam = {base: 2,round: fround}
		fsizeparamb = {base: 2,round: fround,bits: true}
		$.each(datasize,function (index,data) {
			if(index != 0)
			{
				table.tr().td("").attr("class","grey").attr("style","height:2px;")
				$.each(hoursarr,function (key,hours) {table.td("").attr("class","grey").attr("style","height:2px;")})
			}
			
			table.tr().td(filesize(data),fsizeparam).attr("class","grey px112")
			$.each(hoursarr,function (key,hours) {
					table.td(filesize(data/(hours*3600),fsizeparam)+"/s").attr("class","px112")
			}) 	
			
			table.tr().td(filesize(data,fsizeparamb)+"it").attr("class","grey px112")
			$.each(hoursarr,function (key,hours) {
					table.td(filesize(data/(hours*3600),fsizeparamb)+"it/s").attr("class","px112")
			}) 			
		})
		tableResult.append(table.gettbody())
		$("#idPopUpDiv").show()
}

function gbcheck(jobject)
{
	var jqo = $(jobject)
	var data = jqo.val();
	var exp={m:-1,g:0,t:1,p:2};
	var tbtest = /^([0-9.]+)[ ]?([mgtp])[b]?$/i.exec(data); 
	if(tbtest) { 
		var calc = Math.ceil(parseFloat(tbtest[1])*Math.pow(1024,exp[tbtest[2].toLowerCase()]))
		jqo.val(calc) 
	} 
	else if(!(/^([0-9]+)$/.test(data))) { var val = data.replace(/[^0-9.]+/g,""); jqo.val((val == "")?1000:Math.ceil(val)) }
}
function rpcheck(jobject,defaultval) {
	var jqo = $(jobject)
	var data = jqo.val();
	var multi={d:1,w:7,m:31,q:92,y:365};
	var multitest = /^([0-9.]+)[ ]?([dwmqy])?$/i.exec(data); 
	if(multitest) { 
		var gsv = GUIStateVariables()
		var interval = gsv.mappings["interval"].convert()
		var intervalmulti = 1
		if(interval.hours !== undefined)
		{
			intervalmulti = 24/(interval.hours)
		}
		var c = Math.ceil
		var calc = c(parseFloat(multitest[1])*multi[multitest[2].toLowerCase()]*intervalmulti)
		
		jqo.val(calc) 
	}
	else if(!(/^([0-9]+)$/.test(data))) { var val = data.replace(/[^0-9.]+/g,""); jqo.val((val == "")?defaultval:Math.ceil(val)) }
}

</script>


<a href="#" onClick="$('#idDivDev').toggle();return false;" style="color:#FEFEFE;font-size:8px;">#######</a>
<div id="idDivDev" class="hiddenBlock" >
<textarea id="idInput" rows="10" cols="150" ></textarea><br>
<textarea id="idConsole" rows="10" cols="150" ></textarea><br>
<input type="button" value="URL >>" onclick="saveStr()" ><input id="idURLStr" size="100"></input><br>
<table>
<tr><td>Start</td><td><input id="idManStart" value=""/></td></tr>
<tr><td>Stop</td><td><input id="idManStop" value="" /></td></tr>
<tr><td>Show Latest</td><td><input id="idShowLatest" value="0" /></td></tr>
</table>
</div>
<div id="idreferences">
<h1>The Restore Point Simulator</h1>
Current version : <a href="release-notes.txt">0.3.2</a><br> 
Feedback via <a href="https://twitter.com/intent/tweet?screen_name=tdewin" style="text-decoration:none;">@tdewin</a> or on <a href="https://github.com/tdewin/rps/issues">GitHub</a><br>
RPS heavily relies on some opensource <a href="#" onclick="showJS();return false;">javascript frameworks</a><br>
</div>

<div id="idPopUpDiv" class="hiddenBlock">
		<p style="text-align: right;margin:1px; background-color:#deffde;"><span id="idVDclose" onclick="$('#idPopUpDiv').hide()" class="cursorPointer">X</span></p>
		<table id="idTablePopUpDiv">
			<tbody></tbody>
		</table>
</div>

<div>
<h2>Quick Presets</h2>
<select id="scenariosSelect" style="width:300px"></select>
</div>
<div id="idDivGeneral" class="">
		<h2>Configuration</h2>
		<table class="inputTable">
		<tr><td class="fixwidth">Style</td><td class="fixwidth" colspan="2">
			<select id="idStyle" class="alignwidth">
				<option value="1" >Incremental</option>
				<option value="2" >Reverse</option>
				<option value="3" >Backup Copy Job</option>
			</select>
		</td><td></td></tr>
		<tr><td>Used Size GB</td><td colspan="2"><input class="alignwidth" type="text" id="idData" value="1000" onchange="gbcheck(this);return false" ></input></td>
		<td><img src="rpsimg/help.png"  class="cursorPointer" onclick="showHelp('Data Input',['Define how much data is being used in production in gigabyte.',' If you have a bigger environment and you want to enter for example 10tb, you can also enter \'10tb\' without quotes. The moment you go to another field, push enter or click simulate, the value will be converted.','You can also enter floats like \'1.5pb\'.','The field is not case sensitive and the trailing b for byte is optional','Examples: 5.5t, .5p, 512tb, 10TB']);return false;"/></td>
		</tr>
		<tr><td>Retention Points</td><td colspan="2"><input class="alignwidth" type="text" id="idRP" value="14" onchange="rpcheck(this,14);return false" ></input></td>
		<td><img src="rpsimg/help.png"  class="cursorPointer" onclick="showHelp('Restore Points',['How many restore points do you want to keep? This number is the amount of backups and is not necessarily expressed in days. If you want to express it in days, make sure you select a daily interval',
			'If for example you select for example hourly interval, and you enter 24 restore points, you will get 1 days worth of backup',
			'You can also input also time span by adding the correct suffix. For example if you want 7 days worth of backup, taking in consideration the backup interval, you can enter \'7d\'. If you would have selected a backup every 6 hours, this would be converted to 28 days after pushing simulate, focusing on a new field or pushing enter',
			'Examples: \'14d\' (14 days), \'5w\' (5weeks), \'2.5m\' (2.5 months), \'1q\' (1 quarter or 92 days) and \'1y\' (1 year)'
		]);return false;"/></td>
		</tr>
		<tr><td>Change Rate</td><td colspan="2">
			<!--<input class="alignwidth" type="text" id="idDelta" value="10" ></input>-->
			<select id="idDelta" class="alignwidth">
				<option value="3">3%</option>
				<option value="4">4%</option>
				<option value="5">5% Optimistic</option>
				<option value="6">6%</option>
				<option value="7">7%</option>
				<option value="8" >8%</option>
				<option value="10"selected>10% Conservative</option>
				<option value="12">12%</option>
				<option value="15">15%</option>
				<option value="20">20%</option>
				<option value="25">25%</option>
				<option value="30">30%</option>
				<option value="35">35%</option>
				<option value="40">40%</option>
				<option value="50">50%</option>
				<option value="60">60%</option>
				<option value="70">70%</option>
				<option value="80">80%</option>
				<option value="90">90%</option>
				<option value="100">100%</option>
			</select>
		</td><td><img src="rpsimg/help.png" class="cursorPointer"  onclick="showHelp('Change Rate',['This parameter defines how much data changes between backup periods. It influences the size of incrementals. For example, if every day 10% of the data changes and the source size is 1024GB, then only 10% or 100MB needs to be backed up on a daily basis. This 100MB will be further reduced with the data reduction factor.']);return false;"/></td></tr>
		<tr><td>Data left after reduction </td><td colspan="2">
			<!--<input class="alignwidth" type="text" id="idCompression" value="50" ></input>-->
			<!-- 
			$step=5;$min=20;$max=100;(0..(($max-$min)/$step)) | % { ($_*$step)+$min } | % { write-host ("<option value=""{0}"">$_% (100GB > {0}GB)</option>" -f $_) } 
			-->
			<select id="idCompression" class="alignwidth">
				<option value="20">20% (100GB > 20GB)</option>
				<option value="25">25% (100GB > 25GB)</option>
				<option value="30">30% (100GB > 30GB)</option>
				<option value="35">35% (100GB > 35GB)</option>
				<option value="40">40% (100GB > 40GB) Optimistic</option>
				<option value="45">45% (100GB > 45GB)</option>
				<option value="50">50% (100GB > 50GB) Conservative</option>
				<option value="55">55% (100GB > 55GB)</option>
				<option value="60">60% (100GB > 60GB)</option>
				<option value="65">65% (100GB > 65GB)</option>
				<option value="70">70% (100GB > 70GB)</option>
				<option value="75">75% (100GB > 75GB)</option>
				<option value="80">80% (100GB > 80GB)</option>
				<option value="85">85% (100GB > 85GB)</option>
				<option value="90">90% (100GB > 90GB)</option>
				<option value="95">95% (100GB > 95GB)</option>
				<option value="100">100% (100GB > 100GB) No Compression</option>
			</select>
		</td>
		<td><img src="rpsimg/help.png"  class="cursorPointer" onclick="showHelp('Data Reduction',['This parameter defines how much data will be left after data reduction (mainly compression). The parameter is a factor of the original data. For example, if you select 45% and the data set is 1TB, then the resulting full backup will be 450GB (Source Data * Data Reduction Factor in Percentages = Full Backup). The lower the percentage, the smaller the backup. So a lower percentage means a more aggressive compression value. If you want to disable compression, choose 100%. ','If you prefer a reduction factor, for example 2:1, you can easily calculate the input parameter by dividing 100 by the compression factor 2, which results in 50% (100/2). A compression factor of 3:1 would be 100/3 = 33% =~ 35%.','If you prefer a discount factor (like with sales), you can subtract your factor from 100%. For example, if you want -40%, the input factor would be 100-40%=60%.' ]);return false;"/></td>
		</tr>
		<tr><td>Interval</td><td colspan="2">
			<select id="idInterval" class="alignwidth">
				<option value="D" >Daily</option>
				<option value="12" >Every 12 Hours</option>
				<option value="8" >Every 8 Hours</option>
				<option value="6" >Every 6 Hours</option>
				<option value="4" >Every 4 Hours</option>
				<option value="2" >Every 2 Hours</option>
				<option value="1" >Hourly</option>
			</select>
			</td><td></td></tr>
		<tr><td>Time Growth Simulation <input type="checkbox" id="idDataGrowth" onChange="toggleDataGrowth();return false;" ></td>
			<td class="fixwidthhalf">
			<select id="idDataGrowthYear" class="alignwidth" disabled>
				<!-- (1..10) | % { write-host "<option value=""$_"">$_ Year</option>" } -->
				<option value="0.5" >6 Months</option>
				<option value="1" selected >1 Year</option>
				<option value="2" >2 Year</option>
				<option value="3" >3 Year</option>
				<option value="4" >4 Year</option>
				<option value="5" >5 Year</option>
				<option value="6">6 Year</option>
				<option value="7">7 Year</option>
				<option value="8">8 Year</option>
				<option value="9">9 Year</option>
				<option value="10">10 Year</option>
			</select>
			</td><td class="fixwidthhalf">
			<!-- 110,120,130,140,150,160,170,180,190,200,210,220,230,240,250,260,270,280,290,300 | % { write-host "<option value=""$_"">$_%</option>" } -->
			<select id="idDataGrowthRate" class="alignwidth" disabled>
				<option value="0">0%</option>
				<option value="1">1%</option>
				<option value="2">2%</option>
				<option value="3">3%</option>
				<option value="4">4%</option>
				<option value="5">5%</option>
				<option value="6">6%</option>
				<option value="7">7%</option>
				<option value="8">8%</option>
				<option value="9">9%</option>
				<option value="10" selected>10%</option>
				<option value="11">11%</option>
				<option value="12">12%</option>
				<option value="13">13%</option>
				<option value="14">14%</option>
				<option value="15">15%</option>
				<option value="16">16%</option>
				<option value="17">17%</option>
				<option value="18">18%</option>
				<option value="19">19%</option>
				<option value="20">20%</option>
				<option value="21">21%</option>
				<option value="22">22%</option>
				<option value="23">23%</option>
				<option value="24">24%</option>
				<option value="25">25%</option>
				<option value="26">26%</option>
				<option value="27">27%</option>
				<option value="28">28%</option>
				<option value="29">29%</option>
				<option value="30">30%</option>
				<option value="31">31%</option>
				<option value="32">32%</option>
				<option value="33">33%</option>
				<option value="34">34%</option>
				<option value="35">35%</option>
				<option value="36">36%</option>
				<option value="37">37%</option>
				<option value="38">38%</option>
				<option value="39">39%</option>
				<option value="40">40%</option>
				<option value="41">41%</option>
				<option value="42">42%</option>
				<option value="43">43%</option>
				<option value="44">44%</option>
				<option value="45">45%</option>
				<option value="46">46%</option>
				<option value="47">47%</option>
				<option value="48">48%</option>
				<option value="49">49%</option>
				<option value="50">50%</option>
				<option value="51">51%</option>
				<option value="52">52%</option>
				<option value="53">53%</option>
				<option value="54">54%</option>
				<option value="55">55%</option>
				<option value="56">56%</option>
				<option value="57">57%</option>
				<option value="58">58%</option>
				<option value="59">59%</option>
				<option value="60">60%</option>
				<option value="61">61%</option>
				<option value="62">62%</option>
				<option value="63">63%</option>
				<option value="64">64%</option>
				<option value="65">65%</option>
				<option value="66">66%</option>
				<option value="67">67%</option>
				<option value="68">68%</option>
				<option value="69">69%</option>
				<option value="70">70%</option>
				<option value="71">71%</option>
				<option value="72">72%</option>
				<option value="73">73%</option>
				<option value="74">74%</option>
				<option value="75">75%</option>
				<option value="76">76%</option>
				<option value="77">77%</option>
				<option value="78">78%</option>
				<option value="79">79%</option>
				<option value="80">80%</option>
				<option value="81">81%</option>
				<option value="82">82%</option>
				<option value="83">83%</option>
				<option value="84">84%</option>
				<option value="85">85%</option>
				<option value="86">86%</option>
				<option value="87">87%</option>
				<option value="88">88%</option>
				<option value="89">89%</option>
				<option value="90">90%</option>
				<option value="91">91%</option>
				<option value="92">92%</option>
				<option value="93">93%</option>
				<option value="94">94%</option>
				<option value="95">95%</option>
				<option value="96">96%</option>
				<option value="97">97%</option>
				<option value="98">98%</option>
				<option value="99">99%</option>
				<option value="100">100%</option>
				<option value="110">110%</option>
				<option value="120">120%</option>
				<option value="130">130%</option>
				<option value="140">140%</option>
				<option value="150">150%</option>
				<option value="160">160%</option>
				<option value="170">170%</option>
				<option value="180">180%</option>
				<option value="190">190%</option>
				<option value="200">200%</option>
				<option value="210">210%</option>
				<option value="220">220%</option>
				<option value="230">230%</option>
				<option value="240">240%</option>
				<option value="250">250%</option>
				<option value="260">260%</option>
				<option value="270">270%</option>
				<option value="280">280%</option>
				<option value="290">290%</option>
				<option value="300">300%</option>
			</select>
			</td>
			<td><img src="rpsimg/help.png"  class="cursorPointer" onclick="showHelp('Time Growth',['This allows you to simulate a continuous data growth on a daily basis. The first parameter defines how long you want to run the simulation. The second parameter defines the yearly data growth in percentages.','Imagine, you have 1000GB of source data and a time growth factor of 10%. If you execute a simulation for 3 years, the data growth will be calculated by using the following formula : 1000*(1+10%)^1095/365 = 1000*1.1^3 = 1000*1.1*1.1*1.1 = 1331GB. You can easily test this by disabling data reduction (select 100%) and selecting reverse incremental.']);return false;"/></td>
		</tr>
		<!--<tr><td>Start Date</td><td>
			<select id="idStart" class="alignwidth">
				<option value="Tomorrow" >Tomorrow At 22</option>
				<option value="FirstOfMonth" >First Of Next Month At 22</option>
				<option value="FirstOfYear" >First Of Next Year At 22</option>
			</select>
		</td><td></td></tr>-->
	</table>
</div>
<div id="idDivForward" class="inputSpecific hiddenBlock" >
<h2>Incremental Specific</h2>
		<table class="inputTable">
			<tr><td>Synthetic</td>
				<td>
					<input type="checkbox" id="fullcheckbox-synday0" value="MO"><div class="weekspan">MO</div>
					<input type="checkbox" id="fullcheckbox-synday1" value="TU"><div class="weekspan">TU</div>
					<input type="checkbox" id="fullcheckbox-synday2" value="WE"><div class="weekspan">WE</div>
					<input type="checkbox" id="fullcheckbox-synday3" value="TH"><div class="weekspan">TH</div>
					<input type="checkbox" id="fullcheckbox-synday4" value="FR"><div class="weekspan">FR</div>
					<input type="checkbox" id="fullcheckbox-synday5" value="SA"><div class="weekspan">SA</div>
					<input type="checkbox" id="fullcheckbox-synday6" value="SU"><div class="weekspan">SU</div>
				</td>
			</tr>

			<tr><td>Active Full Weekly</td>
				<td>
					<input type="checkbox" id="fullcheckbox-incractday0" value="MO"><div class="weekspan">MO</div>
					<input type="checkbox" id="fullcheckbox-incractday1" value="TU"><div class="weekspan">TU</div>
					<input type="checkbox" id="fullcheckbox-incractday2" value="WE"><div class="weekspan">WE</div>
					<input type="checkbox" id="fullcheckbox-incractday3" value="TH"><div class="weekspan">TH</div>
					<input type="checkbox" id="fullcheckbox-incractday4" value="FR"><div class="weekspan">FR</div>
					<input type="checkbox" id="fullcheckbox-incractday5" value="SA"><div class="weekspan">SA</div>
					<input type="checkbox" id="fullcheckbox-incractday6" value="SU"><div class="weekspan">SU</div>
				</td>
			</tr>
			<tr><td rowspan="2">Active Full Monthly</td>
				<td>
					<input type="checkbox" id="fullcheckbox-incractmonth0" value="Jan"><div class="monthspan">Jan</div>
					<input type="checkbox" id="fullcheckbox-incractmonth1" value="Feb"><div class="monthspan">Feb</div>
					<input type="checkbox" id="fullcheckbox-incractmonth2" value="Mar"><div class="monthspan">Mar</div>
					<input type="checkbox" id="fullcheckbox-incractmonth3" value="Apr"><div class="monthspan">Apr</div>
					<input type="checkbox" id="fullcheckbox-incractmonth4" value="May"><div class="monthspan">May</div>
					<input type="checkbox" id="fullcheckbox-incractmonth5" value="Jun"><div class="monthspan">Jun</div>

				</td>
			</tr>
			<tr>
				<td>
					<input type="checkbox" id="fullcheckbox-incractmonth6" value="Jul"><div class="monthspan">Jul</div>
					<input type="checkbox" id="fullcheckbox-incractmonth7" value="Aug"><div class="monthspan">Aug</div>
					<input type="checkbox" id="fullcheckbox-incractmonth8" value="Sep"><div class="monthspan">Sep</div>
					<input type="checkbox" id="fullcheckbox-incractmonth9" value="Oct"><div class="monthspan">Oct</div>
					<input type="checkbox" id="fullcheckbox-incractmonth10" value="Nov"><div class="monthspan">Nov</div>
					<input type="checkbox" id="fullcheckbox-incractmonth11" value="Dec"><div class="monthspan">Dec</div>
				</td>
			</tr>
		</table>

</div>
<div id="idDivReverse" class="inputSpecific hiddenBlock">
		<h2>Reverse Specific</h2>

		<table class="inputTable">
			<tr><td>Active Full Weekly</td>
				<td>
					<input type="checkbox" id="fullcheckbox-revactday0" value="MO"><div class="weekspan">MO</div>
					<input type="checkbox" id="fullcheckbox-revactday1" value="TU"><div class="weekspan">TU</div>
					<input type="checkbox" id="fullcheckbox-revactday2" value="WE"><div class="weekspan">WE</div>
					<input type="checkbox" id="fullcheckbox-revactday3" value="TH"><div class="weekspan">TH</div>
					<input type="checkbox" id="fullcheckbox-revactday4" value="FR"><div class="weekspan">FR</div>
					<input type="checkbox" id="fullcheckbox-revactday5" value="SA"><div class="weekspan">SA</div>
					<input type="checkbox" id="fullcheckbox-revactday6" value="SU"><div class="weekspan">SU</div>
				</td>
			</tr>
			<tr><td rowspan="2">Active Full Monthly</td>
				<td>
					<input type="checkbox" id="fullcheckbox-revactmonth0" value="Jan"><div class="monthspan">Jan</div>
					<input type="checkbox" id="fullcheckbox-revactmonth1" value="Feb"><div class="monthspan">Feb</div>
					<input type="checkbox" id="fullcheckbox-revactmonth2" value="Mar"><div class="monthspan">Mar</div>
					<input type="checkbox" id="fullcheckbox-revactmonth3" value="Apr"><div class="monthspan">Apr</div>
					<input type="checkbox" id="fullcheckbox-revactmonth4" value="May"><div class="monthspan">May</div>
					<input type="checkbox" id="fullcheckbox-revactmonth5" value="Jun"><div class="monthspan">Jun</div>

				</td>
			</tr>
			<tr>
				<td>
					<input type="checkbox" id="fullcheckbox-revactmonth6" value="Jul"><div class="monthspan">Jul</div>
					<input type="checkbox" id="fullcheckbox-revactmonth7" value="Aug"><div class="monthspan">Aug</div>
					<input type="checkbox" id="fullcheckbox-revactmonth8" value="Sep"><div class="monthspan">Sep</div>
					<input type="checkbox" id="fullcheckbox-revactmonth9" value="Oct"><div class="monthspan">Oct</div>
					<input type="checkbox" id="fullcheckbox-revactmonth10" value="Nov"><div class="monthspan">Nov</div>
					<input type="checkbox" id="fullcheckbox-revactmonth11" value="Dec"><div class="monthspan">Dec</div>
				</td>
			</tr>
		</table>

</div>
<div id="idDivBCJ" class="inputSpecific hiddenBlock">
		<h2>Backup Copy Job Specific</h2>
		<table class="inputTable">
			<tr><td>Weekly</td><td><input class="alignwidth" type="text" id="idGFSW" value="0"></input></td></tr>
			<tr><td>Monthly</td><td><input class="alignwidth" type="text" id="idGFSM" value="0"></input></td></tr>
			<tr><td>Quarterly</td><td><input class="alignwidth" type="text" id="idGFSQ" value="0"></input></td></tr>
			<tr><td>Yearly</td><td><input class="alignwidth" type="text" id="idGFSY" value="0"></input></td></tr>
		</table>
</div>
<div id="idDivRun">
<h2>Run</h2>
<table>
		<tr><td style="width:400px;">
			<input type="checkbox" id="idShowMeHowCheck" onchange="toggleDataGrowth()"/>Manual Run
			<input type="checkbox" id="idShowExport" onchange="return toggleExport()"/>Export
			<input type="checkbox" id="idShowCanvas" onchange="return toggleCanvas()"/>Canvas (experimental)
		</td>
		<td style="width:420px;text-align:right;">
			<input  type="button" value="Simulate" style="width:150px;font-size:14px;background-color:green;color:white;border:1px solid black;" onClick="simulate();return false;">
		</td>
		</tr>
		<tr id="idExportTR" style="display:none;">
			<td colspan="2"><input id="idExportStr" onclick="$(this).select();return false;" class="alignwidth" placeholder="Hit simulate to export and refresh your settings here" ></input></td>
		</tr>
</table>
</div>

<div>
<div id="idShowMeHowResult" class="hiddenBlock" >
			<table id="idTableShowMeHow">
				<tbody></tbody>
			</table>
</div>
<div id="idShowMeHowConsole" class="hiddenBlock"  style="vertical-align:top;"  >
			<table id="idTableShowMeConsole" style="border:1px black solid;">
				<tr><td colspan="5" style="background-image: url('rpsimg/dragme.png');">Manual Run</td></tr>
				<tr><td><input class="alignwidth" type="button" value="1x" onClick="manualrun(1);return false;"></td>
				<td><input class="alignwidth" type="button" value="7x" onClick="manualrun(7);return false;"></td>
				<td><input class="alignwidth" type="button" value="24x" onClick="manualrun(24);return false;"></td>
				<td><input class="alignwidth" type="button" value="28x" onClick="manualrun(28);return false;"></td>
				<td><input class="alignwidth" type="button" value="365x" onClick="manualrun(365);return false;"></td></tr>
			</table>
</div>
</div>
<div id="idResult" class="hiddenBlock">
		<h2>Result</h2>
		<table id="idTableResult">
			<tbody></tbody>
		</table>
</div>
<div id="idDivResultCanvas" class="hiddenBlock">
		<h2>Canvas</h2>
		<img src="rpsimg/cgfs.png" id="idimagegfs" class="hiddenBlock"/>
		<img src="rpsimg/arrowdown.png" id="idimagearrowdown" class="hiddenBlock"/>
		<img src="rpsimg/arrowup.png" id="idimagearrowup" class="hiddenBlock"/>
		<p><a href="" id="idahrefdownload" download="rpsimage.png" >Download PNG (FF/Chrome)</a></p>
		<img id="idimgrender" src="rpsimg/nohtml5.png"/>
		<canvas id="idRenderCanvas" class="hiddenBlock">
		</canvas>
</div>



</body>
</html>